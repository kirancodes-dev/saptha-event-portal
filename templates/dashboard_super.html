{% extends "base.html" %}

{% block content %}
<div class="container-fluid fade-in">
    
    <div class="d-flex justify-content-between align-items-end mb-5">
        <div>
            <h6 class="text-gold fw-bold letter-spacing-2 mb-1 text-uppercase small">System Command Center</h6>
            <h1 class="fw-black text-primary-900 mb-0 display-5">Super Admin</h1>
        </div>
        <div class="d-flex gap-3">
            <span class="text-muted text-end d-none d-md-block small">
                Server Time<br>
                <strong class="text-dark">{{ current_time or 'Online' }}</strong>
            </span>
            <button class="btn btn-danger shadow-lg px-4" data-bs-toggle="modal" data-bs-target="#resetModal">
                <i class="fas fa-power-off me-2"></i> Reset
            </button>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card border-0 shadow-hover h-100 position-relative overflow-hidden">
                <div class="card-body p-4 d-flex align-items-center">
                    <div class="icon-square bg-primary-100 text-primary-700 rounded-3 me-3 p-3">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="text-uppercase text-muted small fw-bold mb-1">Total Users</h6>
                        <h2 class="mb-0 fw-black text-primary-900">{{ stats.total_users }}</h2>
                    </div>
                </div>
                <div class="position-absolute bg-primary-50 rounded-circle" style="width: 100px; height: 100px; top: -20px; right: -20px; opacity: 0.5;"></div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-hover h-100 position-relative overflow-hidden">
                <div class="card-body p-4 d-flex align-items-center">
                    <div class="icon-square bg-accent-100 text-accent-600 rounded-3 me-3 p-3">
                        <i class="fas fa-calendar-star fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="text-uppercase text-muted small fw-bold mb-1">Active Events</h6>
                        <h2 class="mb-0 fw-black text-primary-900">{{ stats.total_events }}</h2>
                    </div>
                </div>
                <div class="position-absolute bg-accent-50 rounded-circle" style="width: 100px; height: 100px; top: -20px; right: -20px; opacity: 0.5;"></div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-hover h-100 position-relative overflow-hidden">
                <div class="card-body p-4 d-flex align-items-center">
                    <div class="icon-square bg-success-bg text-success-text rounded-3 me-3 p-3">
                        <i class="fas fa-user-tie fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="text-uppercase text-muted small fw-bold mb-1">Club Leads</h6>
                        <h2 class="mb-0 fw-black text-primary-900">{{ stats.total_spocs }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-hover h-100 bg-primary-900 text-white cursor-pointer" data-bs-toggle="modal" data-bs-target="#createUserModal">
                <div class="card-body p-4 d-flex align-items-center justify-content-between">
                    <div>
                        <h6 class="text-white-50 text-uppercase small fw-bold mb-1">Quick Action</h6>
                        <h4 class="mb-0 fw-bold">Create User <i class="fas fa-arrow-right ms-2 fs-6"></i></h4>
                    </div>
                    <div class="icon-circle bg-white text-primary-900 rounded-circle p-3 shadow">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-lg overflow-hidden" style="min-height: 500px;">
        <div class="card-header bg-white border-bottom p-0">
            <div class="d-flex justify-content-between align-items-center px-4 py-3 bg-light border-bottom">
                <ul class="nav nav-pills card-header-pills" id="adminTabs" role="tablist">
                    <li class="nav-item me-2">
                        <button class="nav-link active fw-bold px-3" data-bs-toggle="tab" data-bs-target="#tab-spocs">
                            <i class="fas fa-user-shield me-2"></i>Club SPOCs
                        </button>
                    </li>
                    <li class="nav-item me-2">
                        <button class="nav-link fw-bold px-3" data-bs-toggle="tab" data-bs-target="#tab-events">
                            <i class="fas fa-calendar me-2"></i>Events
                        </button>
                    </li>
                    <li class="nav-item me-2">
                        <button class="nav-link fw-bold px-3" data-bs-toggle="tab" data-bs-target="#tab-students">
                            <i class="fas fa-user-graduate me-2"></i>Students
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link fw-bold px-3" data-bs-toggle="tab" data-bs-target="#tab-judges">
                            <i class="fas fa-gavel me-2"></i>Judges
                        </button>
                    </li>
                </ul>
                
                <div class="input-group" style="width: 250px;">
                    <span class="input-group-text bg-white border-end-0 text-muted"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control border-start-0 ps-0" placeholder="Search records...">
                </div>
            </div>
        </div>
        
        <div class="card-body p-0">
            <div class="tab-content">
                
                <div class="tab-pane fade show active" id="tab-spocs">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">User Identity</th>
                                    <th>Login ID</th>
                                    <th>Assigned Domain</th>
                                    <th class="text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for spoc in spocs %}
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle bg-primary-100 text-primary-700 fw-bold me-3">
                                                {{ spoc.name[0] }}
                                            </div>
                                            <div>
                                                <div class="fw-bold text-dark">{{ spoc.name }}</div>
                                                <small class="text-muted">Club Lead</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-muted font-monospace small">{{ spoc.email }}</td>
                                    <td><span class="badge bg-gold-soft border border-warning text-dark">{{ spoc.category }}</span></td>
                                    <td class="text-end pe-4">
                                        <form action="/super_admin/delete_entity/user/{{ spoc.id }}" method="POST" class="d-inline" onsubmit="return confirm('Revoke access for {{ spoc.name }}?');">
                                            <button class="btn btn-icon btn-light text-danger hover-danger"><i class="fas fa-trash-alt"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr><td colspan="4" class="text-center py-5 text-muted">No Club SPOCs found.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-events">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">Event Details</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th class="text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for event in events %}
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="icon-square-sm bg-light rounded me-3 text-muted">
                                                <i class="fas fa-calendar"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold text-dark">{{ event.name }}</div>
                                                <small class="text-muted">{{ event.event_type }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ event.date }}</td>
                                    <td>
                                        {% if event.is_published %}
                                            <span class="badge bg-success-subtle text-success border border-success-subtle"><i class="fas fa-check-circle me-1"></i> Published</span>
                                        {% else %}
                                            <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle"><i class="fas fa-pencil-alt me-1"></i> Draft</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end pe-4">
                                        <form action="/super_admin/delete_entity/event/{{ event.id }}" method="POST" onsubmit="return confirm('Delete event?');">
                                            <button class="btn btn-icon btn-light text-danger hover-danger"><i class="fas fa-trash-alt"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr><td colspan="4" class="text-center py-5 text-muted">No Events found.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-students">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">Student</th>
                                    <th>USN</th>
                                    <th>Department</th>
                                    <th class="text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for s in students %}
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle bg-secondary-subtle text-dark fw-bold me-3">{{ s.name[0] }}</div>
                                            <div>
                                                <div class="fw-bold">{{ s.name }}</div>
                                                <small class="text-muted">{{ s.email }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="font-monospace">{{ s.usn }}</td>
                                    <td>{{ s.department }}</td>
                                    <td class="text-end pe-4">
                                        <form action="/super_admin/delete_entity/user/{{ s.id }}" method="POST">
                                            <button class="btn btn-icon btn-light text-danger hover-danger"><i class="fas fa-ban"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr><td colspan="4" class="text-center py-5 text-muted">No Students found.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-judges">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4">Judge</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th class="text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for j in judges %}
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle bg-dark text-white fw-bold me-3">{{ j.name[0] }}</div>
                                            <div class="fw-bold">{{ j.name }}</div>
                                        </div>
                                    </td>
                                    <td>{{ j.email }}</td>
                                    <td><span class="badge bg-dark">Judge</span></td>
                                    <td class="text-end pe-4">
                                        <form action="/super_admin/delete_entity/user/{{ j.id }}" method="POST">
                                            <button class="btn btn-icon btn-light text-danger hover-danger"><i class="fas fa-trash-alt"></i></button>
                                        </form>
                                    </td>
                                </tr>
                                {% else %}
                                <tr><td colspan="4" class="text-center py-5 text-muted">No Judges found.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="createUserModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form action="/super_admin/create_user" method="POST" class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-primary-900 text-white">
                <h5 class="modal-title fw-bold">Create System User</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4 bg-light">
                <div class="mb-3">
                    <label class="form-label small fw-bold text-uppercase">Role Type</label>
                    <select name="role" class="form-select" id="roleSelect" onchange="toggleFields()">
                        <option value="ClubSPOC">Club SPOC</option>
                        <option value="Judge">Judge</option>
                        <option value="Coordinator">Event Coordinator</option>
                        <option value="Participant">Student / Participant</option>
                    </select>
                </div>
                
                <div class="row g-2 mb-3">
                    <div class="col-md-12">
                        <label class="form-label small fw-bold text-uppercase">Full Name</label>
                        <input type="text" name="name" class="form-control" required>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label small fw-bold text-uppercase">Email Address</label>
                    <input type="email" name="email" class="form-control" required>
                </div>

                <div class="mb-3" id="spocField">
                    <label class="form-label small fw-bold text-uppercase">Club Category</label>
                    <select name="category" class="form-select">
                        <option value="Tech">Technical</option>
                        <option value="Sports">Sports</option>
                        <option value="Cultural">Cultural</option>
                    </select>
                </div>

                <div class="row g-2 mb-3 d-none" id="studentFields">
                    <div class="col-6">
                        <label class="form-label small fw-bold text-uppercase">USN</label>
                        <input type="text" name="usn" class="form-control" placeholder="1XY...">
                    </div>
                    <div class="col-6">
                        <label class="form-label small fw-bold text-uppercase">Department</label>
                        <input type="text" name="department" class="form-control" placeholder="CSE">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label small fw-bold text-uppercase">Default Password</label>
                    <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-key text-muted"></i></span>
                        <input type="text" name="password" class="form-control" value="welcome123">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary w-100 fw-bold">Create Account</button>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="resetModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title fw-bold">⚠️ Emergency Reset</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4 text-center">
                <div class="mb-3 text-danger"><i class="fas fa-radiation fa-4x animate-pulse"></i></div>
                <h5 class="fw-bold text-danger">Data Wipe Protocol</h5>
                <p class="text-muted small">This action is irreversible. All Events, Teams, Scores, and Student data will be permanently deleted. Only Admin accounts will be preserved.</p>
                <form action="/super_admin/system_reset" method="POST">
                    <div class="mb-3">
                        <label class="small fw-bold">Type "DELETE" to confirm</label>
                        <input type="text" name="confirm_text" class="form-control text-center font-monospace" placeholder="DELETE">
                    </div>
                    <button class="btn btn-danger w-100 fw-bold">EXECUTE RESET</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleFields() {
        const role = document.getElementById('roleSelect').value;
        const spocField = document.getElementById('spocField');
        const studentFields = document.getElementById('studentFields');
        
        spocField.style.display = 'none';
        studentFields.classList.add('d-none');
        
        if (role === 'ClubSPOC') {
            spocField.style.display = 'block';
        } else if (role === 'Participant') {
            studentFields.classList.remove('d-none');
        }
    }
</script>
{% endblock %}